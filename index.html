<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Laporan Keuangan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 p-6">

<!-- HEADER -->
<h1 class="text-2xl font-bold mb-6">ðŸ“Š Laporan Keuangan</h1>

<!-- DASHBOARD -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
  <div class="bg-green-100 p-4 rounded shadow">
    <p class="text-sm text-green-700">Pemasukan</p>
    <h2 id="pemasukan" class="text-xl font-bold text-green-800">Rp 0</h2>
  </div>
  <div class="bg-red-100 p-4 rounded shadow">
    <p class="text-sm text-red-700">Pengeluaran</p>
    <h2 id="pengeluaran" class="text-xl font-bold text-red-800">Rp 0</h2>
  </div>
  <div class="bg-blue-100 p-4 rounded shadow">
    <p class="text-sm text-blue-700">Saldo</p>
    <h2 id="saldo" class="text-xl font-bold text-blue-800">Rp 0</h2>
  </div>
</div>

<!-- FORM INPUT -->
<form id="formTransaksi"
  class="grid grid-cols-1 md:grid-cols-7 gap-3 bg-white p-4 rounded shadow mb-6">

  <input type="date" id="tanggal"
    class="border p-2 rounded" required />

  <input type="text" id="catatan"
    placeholder="Catatan"
    class="border p-2 rounded" />

  <select id="jenis" class="border p-2 rounded" required>
    <option value="pemasukan">Pemasukan</option>
    <option value="pengeluaran">Pengeluaran</option>
  </select>

  <!-- KATEGORI (HARUS SAMA DENGAN DB) -->
  <select id="kategori" class="border p-2 rounded" required>
    <option value="">-- Pilih Kategori --</option>

    <option>Marketing dan promosi</option>
    <option>Jasa photography</option>
    <option>Cetak media promosi</option>
    <option>Event</option>
    <option>Bazzar dan pameran</option>
    <option>Kemasan</option>
    <option>Beban angkut penjualan</option>
    <option>Labeling</option>
    <option>Visual Merchandise</option>
    <option>Sponsorship</option>
    <option>Survey</option>
    <option>Gaji dan kesejahteraan karyawan</option>
    <option>Pengembangan Karyawan</option>
    <option>Seragam Karyawan</option>
    <option>Listrik air dan telepon</option>
    <option>Sewa</option>
    <option>Perlengkapan dan peralatan kantor</option>
    <option>Transportasi</option>
    <option>Paket dan ekspedisi</option>
    <option>Perjalanan Dinas</option>
    <option>Beban reparasi dan pemeliharaan aset tetap</option>
    <option>Pajak dan retribusi</option>
    <option>Relasi, customer dan VIP</option>
    <option>Konsolidasi</option>
    <option>Umum</option>
    <option>Iuran</option>
    <option>Sumbangan</option>
    <option>CSR</option>
    <option>Jasa konsultasi</option>
    <option>Inovasi</option>
    <option>Asuransi</option>
    <option>Administrasi</option>
    <option>Other</option>
    <option>Pembelian Aset</option>
    <option>Cicilan Aset</option>
    <option>Cicilan Bank</option>
    <option>Piutang Karyawan</option>
    <option>Piutang Boko</option>
    <option>Piutang Jiwa Jogja</option>
    <option>Piutang Cafe</option>
  </select>

  <input type="number" id="nominal"
    placeholder="Nominal"
    class="border p-2 rounded"
    required />

  <input type="number" id="qty"
    placeholder="Qty"
    value="1"
    min="1"
    class="border p-2 rounded"
    required />

  <button
    class="md:col-span-7 bg-blue-600 hover:bg-blue-700 text-white p-2 rounded">
    Simpan
  </button>
</form>

<!-- TABLE -->
<div class="flex gap-2 mb-4">
  <input type="month" id="filterBulan" class="border p-2 rounded">
  <button id="btnFilter" class="bg-blue-600 text-white px-4 rounded">
    Filter
  </button>
  <button id="btnReset" class="bg-gray-400 text-white px-4 rounded">
    Reset
  </button>
</div>

  
<div class="bg-white rounded shadow overflow-x-auto">
  <table class="min-w-full text-sm">
    <thead class="bg-gray-200">
      <tr>
        <th class="p-2 text-left">Tanggal</th>
        <th class="p-2 text-left">Catatan</th>
        <th class="p-2">Jenis</th>
        <th class="p-2">Kategori</th>
        <th class="p-2 text-right">Nominal</th>
        <th class="p-2 text-right">Qty</th>
        <th class="p-2 text-right">Total</th>
        <th class="p-2">Aksi</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>
</div>

<script type="module">
import {
  getTransaksi,
  getTransaksiByBulan,
  addTransaksi,
  updateTransaksi,
  deleteTransaksi
} from './js/transaksi.js';

const tbody = document.getElementById('tbody');
const pemasukanEl = document.getElementById('pemasukan');
const pengeluaranEl = document.getElementById('pengeluaran');
const saldoEl = document.getElementById('saldo');

const filterBulan = document.getElementById('filterBulan');
const btnFilter = document.getElementById('btnFilter');
const btnReset = document.getElementById('btnReset');

const formTransaksi = document.getElementById('formTransaksi');

let editId = null;

/* ===== RENDER ===== */
function renderTable(data) {
  let pemasukan = 0;
  let pengeluaran = 0;
  tbody.innerHTML = '';

  data.forEach(item => {
    if (item.jenis === 'pemasukan') pemasukan += item.total;
    else pengeluaran += item.total;

    tbody.innerHTML += `
      <tr class="border-t">
        <td class="p-2">${item.tanggal}</td>
        <td class="p-2">${item.catatan ?? ''}</td>
        <td class="p-2 text-center">${item.jenis}</td>
        <td class="p-2">${item.kategori}</td>
        <td class="p-2 text-right">Rp ${item.nominal.toLocaleString()}</td>
        <td class="p-2 text-right">${item.qty}</td>
        <td class="p-2 text-right font-semibold">
          Rp ${item.total.toLocaleString()}
        </td>
        <td class="p-2 text-center">
          <button onclick='edit(${JSON.stringify(item)})'
            class="text-blue-600 hover:underline">Edit</button>
          |
          <button onclick="hapus('${item.id}')"
            class="text-red-600 hover:underline">Hapus</button>
        </td>
      </tr>
    `;
  });

  pemasukanEl.textContent = 'Rp ' + pemasukan.toLocaleString();
  pengeluaranEl.textContent = 'Rp ' + pengeluaran.toLocaleString();
  saldoEl.textContent = 'Rp ' + (pemasukan - pengeluaran).toLocaleString();
}

/* ===== LOAD ===== */
async function loadData() {
  const { data } = await getTransaksi();
  renderTable(data);
}

/* ===== FILTER BULAN ===== */
btnFilter.onclick = async () => {
  if (!filterBulan.value) {
    alert('Pilih bulan dulu');
    return;
  }
  const { data } = await getTransaksiByBulan(filterBulan.value);
  renderTable(data);
};

btnReset.onclick = loadData;

/* ===== EDIT ===== */
window.edit = (item) => {
  editId = item.id;
  tanggal.value = item.tanggal;
  catatan.value = item.catatan;
  jenis.value = item.jenis;
  kategori.value = item.kategori;
  nominal.value = item.nominal;
  qty.value = item.qty;
};

/* ===== DELETE ===== */
window.hapus = async (id) => {
  await deleteTransaksi(id);
  loadData();
};

/* ===== SUBMIT ===== */
formTransaksi.onsubmit = async (e) => {
  e.preventDefault();

  const payload = {
    tanggal: tanggal.value,
    catatan: catatan.value,
    jenis: jenis.value,
    kategori: kategori.value,
    nominal: Number(nominal.value),
    qty: Number(qty.value)
  };

  if (editId) {
    await updateTransaksi(editId, payload);
    editId = null;
  } else {
    await addTransaksi(payload);
  }

  formTransaksi.reset();
  loadData();
};

loadData();
</script>


</body>
</html>




